@using AasxServerBlazor.TreeVisualisation
@using AasxServer
@inject IQrCodeService QrCodeService
@namespace AasxServerBlazor.Pages.TreeNodeComponents

@code {
    [Parameter] public TreeItem SelectedNode { get; set; }
}

<div class="node-element-container" id="qr-code-component">
    @if (SelectedNode is {Tag: AssetAdministrationShell})
    {
        var tag = SelectedNode.Tag;
        var qrCodeImageBase64 = string.Empty;
        var qrCodeLink = string.Empty;

        if (!Program.generatedQrCodes.ContainsKey(tag) || string.IsNullOrEmpty(QrCodeService.GetQrCodeImage(SelectedNode)) || string.IsNullOrEmpty(qrCodeImageBase64))
        {
            qrCodeLink = QrCodeService.GetQrCodeLink(SelectedNode);
            var qrcodeImage = QrCodeService.GetQrCodeImage(SelectedNode);
            if (!string.IsNullOrEmpty(qrcodeImage))
            {
                qrCodeImageBase64 = qrcodeImage;
            }
            else
            {
                QrCodeService.CreateQrCodeImage(SelectedNode);
                qrCodeImageBase64 = QrCodeService.GetQrCodeImage(SelectedNode);
            }
        }

        if (!string.IsNullOrEmpty(qrCodeImageBase64))
        {
            <a href="@qrCodeLink" class="qr-code-image" target="_blank">
                <div class="qr-code-image">
                    <img src="data:image;base64,@qrCodeImageBase64"  alt="Qrcode Image"/>
                </div>
            </a>
        }
        else if (!string.IsNullOrEmpty(qrCodeLink))
        {
            <a href="@qrCodeLink" target="_blank" class="qr-code-link">@qrCodeLink</a>
            <br/>
        }
    }
</div>